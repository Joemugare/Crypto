{% extends 'base.html' %}
{% load format_filters %}

{% block title %}Watchlist - Crypto Tracker{% endblock %}

{% block content %}
<div class="container">
    <h2>Watchlist</h2>

    <form method="post" action="{% url 'add_to_watchlist' %}">
        {% csrf_token %}
        <label for="cryptocurrency">Cryptocurrency:</label>
        <input type="text" name="cryptocurrency" id="cryptocurrency" placeholder="e.g., bitcoin" required>
        <button type="submit">Add to Watchlist</button>
    </form>

    <div class="card mt-4 glow-effect">
        <div class="card-header">
            <h3 class="card-title"><i class="fas fa-star"></i> Your Watchlist</h3>
        </div>
        <div class="card-body">
            {% if watchlist %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Cryptocurrency</th>
                                <th>Current Price (USD)</th>
                                <th>24h Change</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in watchlist %}
                                <tr>
                                    <td>{{ item.cryptocurrency|default:"Unknown" }}</td>
                                    <td>${{ item.current_price|default:"0.00"|format_currency }}</td>
                                    <td>
                                        <span class="{% if item.usd_24h_change|default:0.0 >= 0 %}positive{% else %}negative{% endif %}">
                                            {% if item.usd_24h_change|default:0.0 >= 0 %}▲{% else %}▼{% endif %}
                                            {{ item.usd_24h_change|default:0.0|abs_value|floatformat:2 }}%
                                        </span>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p class="text-center">Your watchlist is empty. Add cryptocurrencies above.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}
